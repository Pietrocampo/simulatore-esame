
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Quiz</title>
<style>
body { font-family: Arial; max-width: 900px; margin: auto; }
.question { margin-bottom: 20px; }
.timer { font-size: 22px; color: red; font-weight: bold; }
</style>
</head>
<body>
<h2>Esame in corso</h2>
<div class="timer" id="timer">50:00</div>
<form id="quiz"></form>
<button onclick="finish()">Termina esame</button>
<script>
let questions = [];
let time = 50 * 60;
fetch("domande.csv")
  .then(res => res.text())
  .then(text => {
    const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
    const rows = lines.slice(1);
questions = rows
  .map(r => r.split(";"))
  .filter(p => p.length >= 4 && p[0] && p[1] && p[2] && p[3])
  .map(p => ({
    q: p[0].trim(),
    correct: p[1].trim(),
    options: shuffle([
      p[1].trim(),
      p[2].trim(),
      p[3].trim()
    ])
  }));
    questions = shuffle(questions).slice(0, 50);
    alert("Domande caricate: " + questions.length);
    renderQuiz();
  })
  .catch(err => {
    alert("Errore nel caricamento delle domande");
    console.error(err);
  });
function renderQuiz() {
  const form = document.getElementById("quiz");
  form.innerHTML = "";
  questions.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "question";
    div.innerHTML = `<p><strong>${i+1}. ${q.q}</strong></p>` +
      q.options.map(o =>
        `<label>
          <input type="radio" name="q${i}" value="${o}"> ${o}
        </label><br>`
      ).join("");
    form.appendChild(div);
  });
}
function finish() {
  const answers = [];
  questions.forEach((q, i) => {
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    answers.push({
      question: q.q,
      correct: q.correct,
      userAnswer: sel ? sel.value : null
    });
  });

  localStorage.setItem("results", JSON.stringify(answers));
  window.location.href = "result.html";
}
function shuffle(a) {
  return a.sort(() => Math.random() - 0.5);
}
setInterval(() => {
  time--;
  if (time <= 0) finish();
  document.getElementById("timer").textContent =
    Math.floor(time/60) + ":" + String(time%60).padStart(2,"0");
}, 1000);
</script>
</body>
</html>



