
<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Quiz</title>
<style>
body { font-family: Arial; max-width: 900px; margin: auto; }
.question { margin-bottom: 20px; }
.timer { font-size: 22px; color: red; font-weight: bold; }
</style>
</head>
<body>
<h2>Esame in corso</h2>
<div class="timer" id="timer">50:00</div>
<form id="quiz"></form>
<button onclick="finish()">Termina esame</button>
<script>
let questions = [];
let time = 50 * 60;

  .catch(err => {
    alert("Errore nel caricamento delle domande");
    console.error(err);
  });
function renderQuiz() {
  const form = document.getElementById("quiz");
  form.innerHTML = "";
  questions.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "question";
    div.innerHTML = `<p><strong>${i+1}. ${q.q}</strong></p>` +
      q.options.map(o =>
        `<label>
          <input type="radio" name="q${i}" value="${o}"> ${o}
        </label><br>`
      ).join("");
    form.appendChild(div);
  });
}fetch("domande.csv")
  .then(res => res.text())
  .then(text => {
    const lines = text.split(/\r?\n/);

    questions = [];

    for (let i = 1; i < lines.length; i++) {
      let line = lines[i].trim();
      if (!line) continue;

      let sep = line.includes(";") ? ";" : ",";
      let p = line.split(sep);

      if (p.length < 4) continue;

      questions.push({
        q: p[0].trim(),
        correct: p[1].trim(),
        options: shuffle([
          p[1].trim(),
          p[2].trim(),
          p[3].trim()
        ])
      });
    }

    questions = shuffle(questions).slice(0, 50);

    if (questions.length === 0) {
      alert("Nessuna domanda valida trovata nel CSV");
      return;
    }

    renderQuiz();
  });

function finish() {
  const answers = [];
  questions.forEach((q, i) => {
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    answers.push({
      question: q.q,
      correct: q.correct,
      userAnswer: sel ? sel.value : null
    });
  });

  localStorage.setItem("results", JSON.stringify(answers));
  window.location.href = "result.html";
}
function shuffle(a) {
  return a.sort(() => Math.random() - 0.5);
}
setInterval(() => {
  time--;
  if (time <= 0) finish();
  document.getElementById("timer").textContent =
    Math.floor(time/60) + ":" + String(time%60).padStart(2,"0");
}, 1000);
</script>
</body>
</html>




